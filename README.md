# 프로젝트명- 팀명

## 🤗👨‍💻👩‍💻  팀원 소개

<table>
  <tr>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/8aef79a6-76b5-496a-ada1-40fc96373a83" width="100"  height="100"><br>
      <b><a href="https://github.com/kimdoyun0806">김도윤</a></b><br>팀원
    </td>
     <td align="center">
      <img src="https://github.com/user-attachments/assets/8aef79a6-76b5-496a-ada1-40fc96373a83" width="100"  height="100"><br>
      <b><a href="">김민석</a></b><br>팀원
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/8aef79a6-76b5-496a-ada1-40fc96373a83" width="100" height="100"><br>
      <b>🏆 <a href="https://github.com/namoo36">이승용</a></b><br><b>팀장</b>
    </td>
    <td align="center">
      <img src="https://github.com/user-attachments/assets/8aef79a6-76b5-496a-ada1-40fc96373a83" width="100"  height="100"><br>
      <b><a href="https://github.com/jelee55">이제경</a></b><br>팀원
    </td>
  </tr>
</table>

<br>

## 기술 스택
### 🌐 Backend
<img src="https://img.shields.io/badge/java-007396?style=for-the-badge&logo=java&logoColor=white"> <img src="https://img.shields.io/badge/spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white">
<img src="https://img.shields.io/badge/springboot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
<img src="https://img.shields.io/badge/Spring Security-6DB33F?style=for-the-badge&logo=Spring Security&logoColor=white"> ![JWT](https://img.shields.io/badge/JWT-000000?style=for-the-badge&logo=jsonwebtokens&logoColor=white) ![QueryDSL](https://img.shields.io/badge/QueryDSL-005571?style=for-the-badge&logo=hibernate&logoColor=white)

### 🌐 Frontend
<img src="https://img.shields.io/badge/css3-1572B6?style=for-the-badge&logo=css3&logoColor=white"> <img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white"> <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=JavaScript&logoColor=white"> <img src="https://img.shields.io/badge/Axios-5A29E4?style=for-the-badge&logo=Axios&logoColor=white"> <img src="https://img.shields.io/badge/vue.js-4FC08D?style=for-the-badge&logo=Vue.js&logoColor=white"> <img src="https://img.shields.io/badge/bootstrap-7952B3?style=for-the-badge&logo=bootstrap&logoColor=white">

### 🗃️ DB
<img src="https://img.shields.io/badge/mariaDB-003545?style=for-the-badge&logo=mariaDB&logoColor=white"> <img src="https://img.shields.io/badge/Redis-DC382D?style=for-the-badge&logo=Redis&logoColor=white"> 

### ⚙️ Tools
<img src="https://img.shields.io/badge/Git-F05032?style=for-the-badge&logo=Git&logoColor=white"> <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white"> <img src="https://img.shields.io/badge/Figma-9C29B1?style=for-the-badge&logo=Figma&logoColor=white"> <img src="https://img.shields.io/badge/Postman-FF6C37?style=for-the-badge&logo=Postman&logoColor=white"> <img src="https://img.shields.io/badge/Swagger-85EA2D?style=for-the-badge&logo=Swagger&logoColor=white"> <img src="https://img.shields.io/badge/erdCloud-0097A7?style=for-the-badge&logo=erdCloud&logoColor=white">

### 🚀 CI/CD
<img src="https://img.shields.io/badge/AWS EC2-232F3E?style=for-the-badge&logo=amazonaws&logoColor=white"> <img src="https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=Docker&logoColor=white"> <img src="https://img.shields.io/badge/DockerHub-2496ED?style=for-the-badge&logo=docker&logoColor=white"> <img src="https://img.shields.io/badge/Kubernetes-326CE5?style=for-the-badge&logo=Kubernetes&logoColor=white"> <img src="https://img.shields.io/badge/ArgoCD-F5503C?style=for-the-badge&logo=argo&logoColor=white">

### 💬 Communication
<img src="https://img.shields.io/badge/Jira-0052CC?style=for-the-badge&logo=Jira&logoColor=white"> <img src="https://img.shields.io/badge/Discord-7289DA?style=for-the-badge&logo=Discord&logoColor=white"> <img src="https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=Notion&logoColor=white">

<br>

## 📌 목차

1. [프로젝트 소개](#-프로젝트-소개)
2. [WBS](#-wbs)
2. [요구사항 명세서](#-요구사항-명세서)
4. [시스템 아키텍처](#-시스템-아키텍처)
5. [ERD 설계](#-erd-설계)
6. [CI/CD 파이프라인](#️-cicd-파이프라인)
7. [CI/CD 테스트 결과](#-cicd-테스트-결과)
8. [오토스케일링](#오토스케일링)
9. [무중단 배포](#무중단-배포)
10. [ArgoCD](#argocd)
    
<br><br>

## 🌟 프로젝트 소개

![시장 그래프](https://github.com/user-attachments/assets/3d3cfb19-c0a3-4717-9ff6-d6a607407a03)  
> **2023년 기준**, 국내에서 판매된 건강기능식품의 매출은 **3조 7,677억 원**에 달하며,  
> 건강기능식품을 섭취하는 사람들의 수요는 계속해서 **증가**하고 있습니다.

그러나 건강기능식품을 선택할 때,  
개인의 **건강 상태**와 **생활 습관**에 맞는 제품을 선택하는 것이 매우 중요합니다.  
특히 **알레르기**나 **약물과의 상호작용**을 고려해야 하므로,  
**전문가의 상담을 통해 최적의 제품을 선택**하는 것이 필수적입니다.

---

### 🧬 영양갱이란?

**개인 맞춤형 건강기능식품**을 제공하고  
사용자가 보다 **안전하고 신뢰할 수 있는 제품**을 선택할 수 있도록 돕는 헬스케어 서비스입니다.  

또한 건강기능식품의 **적절한 섭취를 유도**하고,  
사용자의 **건강을 최적화**하는 데 중요한 역할을 합니다.

---

## 🧠 개인 맞춤형 건강기능식품 추천 서비스

### ✔️ 서비스 개요
사용자의 **건강 상태**와 **생활 습관**을 분석하여  
가장 적합한 영양제를 **맞춤 추천**하는 서비스입니다.

### ✔️ 서비스 장점
- 사용자는 **필요한 정보**를 충분히 제공받고  
- **알레르기** 또는 **약물 상호작용**으로 인한 **부작용을 예방**할 수 있습니다.
- **불필요한 소비를 줄이고**, 꼭 필요한 제품만 **선택적으로 구매**할 수 있도록 돕습니다.

---

> 🔎 “건강을 챙긴다는 것, 이제는 **데이터 기반의 맞춤형 선택**으로 시작됩니다.”

<br>

## 🛠️ 주요 기능

### ✔️ 개인 맞춤형 건강기능식품 추천
- 건강 문진 데이터를 기반으로 한 **추천 알고리즘**
- 섭취량, 주의사항 안내 및 **부작용 예방 정보 제공**

### ✔️ 약사 1:1 상담
- 전문 약사와의 **실시간 상담**
- 약물 상호작용, 중복 섭취 등 **건강 리스크 사전 예방**

### ✔️ 건강 정보 공유 커뮤니티
- **자유 게시판**을 통한 사용자 경험 공유
- 최신 건강 이슈 및 **영양제 트렌드 제공**

<br>

## 🌱 프로젝트 기대 효과

### 🎯 최적의 건강관리 지원
- 개인 맞춤형 영양제를 통해 **불필요한 구매 최소화**
- 사용자의 건강 상태에 딱 맞는 **영양제 조합 제안**

### 🛡️ 안전한 섭취 유도
- **중복 섭취, 부작용 등 사전 예방 시스템**
- 전문가 상담을 통한 **신뢰도 높은 건강관리**

### 🛒 소비자 편의성과 신뢰도 향상
- 영양제의 **성분, 효과, 섭취법 등 비교 정보 제공**
- **추천 기반 구매**로 효율적인 소비 가능

### 💬 커뮤니티 활성화
- 건강 관심사를 공유하고 **서로의 경험을 학습**
- **건강한 삶을 위한 소통 공간 마련**

### 📈 데이터 기반 최적화
- 사용자 피드백 및 건강 데이터를 바탕으로  
  **지속적인 알고리즘 개선 및 서비스 정밀화**

<br><br>

## 📚 WBS

<details>
<summary>📄 WBS 문서 보기</summary>

🔗 [WBS 링크](https://docs.google.com/spreadsheets/d/15YYf8uofEw9gY0yJmCZ47F-nCaSvJ7-zgntefZcZcI8/edit?usp=sharing)
</details>

![WBS 이미지](https://github.com/user-attachments/assets/404be2bf-9a79-4989-ae36-80f1d01a2186)

<br><br>

## 📝 요구사항 명세서

<details>
<summary>📄 요구사항 명세서 보기</summary>

🔗 [요구사항 명세서 링크](https://docs.google.com/spreadsheets/d/1TTMjfj1YzECr6DAoFVO8egKHkfiWsfq1BlWVQVYVd1M/edit?usp=sharing)
</details>

<img src="https://github.com/user-attachments/assets/31b2672e-1fe1-4dda-acce-aa0aa280dab2" width="70%">

<br><br>

## 🗂️ ERD 설계

<details>
<summary>📄 ERD 보기</summary>

🔗 [ERD 링크](https://www.erdcloud.com/d/k45NzTHZqR2g769kv)
</details>

![ERD 이미지](https://github.com/user-attachments/assets/cef667aa-ef02-4ba9-82b4-76dd227a586e)

<br><br>

## 🧱 시스템 아키텍처

> 프론트엔드부터 백엔드, 데이터베이스, 배포 구조까지  
> **서비스의 전체적인 흐름을 시각화**하여 구성했습니다.

![시스템 아키텍처](https://github.com/user-attachments/assets/d572aa7a-4f2f-4e8d-a113-758eb5939462)


<br><br>

## 🛠️ CI/CD 파이프라인

> **개발부터 배포까지**, 자동화된 파이프라인을 통해  
> **일관된 품질과 빠른 배포**를 실현했습니다.

<details><summary>Backend pipeline

</summary>

```yaml
 
pipeline {
    agent {
        kubernetes {
            yaml '''
            apiVersion: v1
            kind: Pod
            metadata:
              name: jenkins-agent
            spec:
              containers:
              - name: gradle
                image: gradle:8.5-jdk21-alpine
                command:
                - cat
                tty: true
              - name: docker
                image: docker:27.2.0-alpine3.20
                command:
                - cat
                tty: true
                volumeMounts:
                - mountPath: "/var/run/docker.sock"
                  name: docker-socket
              volumes:
              - name: docker-socket
                hostPath:
                  path: "/var/run/docker.sock"
            '''
        }
    }
    // 전체 파이프라인에서 공통적으로 사용할 환경변수
    environment {
        // IMAGE_NAME : 도커hub에 올릴 이름
        // IMAGE_NAME = "namoo36/yyGang-api"
        TAG = "latest"
        DOCKER_IMAGE_NAME = 'namoo36/yygang-api'
        DOCKER_CREDENTIALS_ID = 'dockerhub-access'
    }

    stages {
        stage('Gradle Build') {
            steps {
                container('gradle') {
                    sh 'pwd'
                    sh 'ls -al'
                    sh './gradlew clean build' // 프로젝트 clean -> build
                    sh 'ls -al build/libs'
                }
            }
        }
        stage('Image build & Push'){
            steps {
                container('docker'){
                    script{
                        // 그루비 변수 사용 -> 환경 변수를 사용해 이름/버전정보를 가져오도록 설정
                        def dockerImageVersion = "${env.BUILD_NUMBER}"

                        sh 'docker logout'

                        // withCredentials
                        // - 파이프라인에서 자격 증명을 사용할 수 있는 블록을 생성한다.
                        // usernamePassword
                        // - 자격증명 중 사용자 이름과 비밀번호를 가져올 때 사용함
                        // - credentialsId는 자격 증명에서 가져온 사용자 이름, 아이디
                        // - usernameVariable은 자격 증명에서 가져온 사용자 이름을 저장하는 환경 변수의 이름을 작성한다.
                        // - passwordVariabl는 자격 증명에서 가져온 비밀번호를 저장하는 환경 변수의 이름을 작성
                        withCredentials([usernamePassword(
                            credentialsId: DOCKER_CREDENTIALS_ID, 
                            passwordVariable: 'DOCKER_PASSWORD', 
                            usernameVariable: 'DOCKER_USERNAME')]){
                            // 자격 증명은 이 블럭 안에서만 유효함ㅇㅇ
                            sh 'echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin'
                        }

                        // 파이프라인 단계에서 환경 변수를 설정하는 역할을 한다.
                        withEnv(["DOCKER_IMAGE_VERSION=${dockerImageVersion}"]){
                            sh 'docker -v'
                            sh 'echo $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION'
                            // sh 'docker images university-api'
                            sh 'docker build --no-cache -t $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION ./'
                            sh 'docker image inspect $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION'
                            sh 'docker push $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION'
                        }

                    }
                }
            }
        }

        // stage('Run App') {
        //     steps {
        //         container('gradle') {
        //             sh 'java -jar build/libs/yyGang-0.0.1-SNAPSHOT.jar > app.log 2>&1 &'
        //         }
        //     }
        // }
        // manifest 실행 스테이지ㅎㅎ
        stage('Trigger yygang-manifest'){
            steps{
                script {
                    def dockerImageVersion = "${env.BUILD_NUMBER}"

                     withEnv(["DOCKER_IMAGE_VERSION=${dockerImageVersion}"]){
                            // 다른 잡을 빌드하면서 파라미터 전달
                            build job: 'yygang-manifest',
                                parameters: [
                                    string(name: 'DOCKER_IMAGE_VERSION',defaultValue: 'latest', value: "${DOCKER_IMAGE_VERSION}")
                                ],
                                wait: true // 하위 잡이 끝날 떄까지 기다림
                        }
                }
            }
        }
    }


    post {
        always{
            withCredentials([string(
                credentialsId: 'discord-webhook', 
                variable: 'DISCORD_WEBHOOK_URL'
            )]){
                discordSend description: """
                제목 : ${currentBuild.displayName}
                결과 : ${currentBuild.result}
                실행 시간 : ${currentBuild.duration / 1000}s
                """,
                result: currentBuild.currentResult,
                title: "${env.JOB_NAME} : ${currentBuild.displayName}", 
                webhookURL: "${DISCORD_WEBHOOK_URL}"
            }
        }
    }
}

```
</details>

<details><summary>Backend manifest pipeline

</summary>

```yaml

pipeline {
    agent any
    parameters {
        string(name: 'DOCKER_IMAGE_VERSION', defaultValue: '', description: 'parameter')
    }
    stages {
        stage('Update deploy.yaml') {
            steps {
                // Jenkins 파이프라인에서 작업 디렉토리를 변경하는 과정
                script{
                    def imageTag = "${params.DOCKER_IMAGE_VERSION}"
                    echo "${params.DOCKER_IMAGE_VERSION}"
                    sh 'pwd'
                    sh 'ls -al'
                    sh 'git checkout main'
                    sh "sed -i 's|namoo36/yygang-api:.*|namoo36/yygang-api:${params.DOCKER_IMAGE_VERSION}|g' yygang-be/deploy.yaml"
                    sh 'cat yygang-be/deploy.yaml'
                }
            }
        }
        // stage('Echo Param Value') {
        //     steps {
        //         echo "DOCKER_IMAGE_VERSION param received: '${params.DOCKER_IMAGE_VERSION}'"
        //     }
        // }
        stage('Commit & Push'){
            steps {
                sh 'git config --list'
                sh 'git config user.name "namoo36"'
                sh 'git config user.email "wldnrkwhr36@naver.com"'
                sh 'git config --list'
                sh 'git add .'
                sh "git commit -m 'Update Image Version ${params.DOCKER_IMAGE_VERSION}'"
                // sh 'git diff --cached --quiet || git commit -m "Update Image Version ${params.DOCKER_IMAGE_VERSION}"'
                sh 'git status'
                // 활성화 -> 젠킨스에 등록한 키 이름 주기
                sshagent(['yyGang-manifest-key']){
                    sh 'git push'
                }
            }
        }
    }
 }
```
</details>


<details><summary>Frontend pipeline

</summary>

```yaml

pipeline {
    agent {
        kubernetes {
            yaml '''
            apiVersion: v1
            kind: Pod
            metadata:
              name: jenkins-agent
            spec:
              containers:
              - name: node
                image: node:18-alpine
                command:
                - cat
                tty: true
              - name: docker
                image: docker:27.2.0-alpine3.20
                command:
                - cat
                tty: true
                volumeMounts:
                - mountPath: "/var/run/docker.sock"
                  name: docker-socket
              volumes:
              - name: docker-socket
                hostPath:
                  path: "/var/run/docker.sock"
            '''
        }
    }

    environment {
        TAG = "latest"
        DOCKER_IMAGE_NAME = 'namoo36/yygang-app'
        DOCKER_CREDENTIALS_ID = 'dockerhub-access'
    }

    stages {
        stage('Install & Build') {
            steps {
                container('node') {
                    sh 'pwd'
                    sh 'ls -al'
                    sh 'npm install'
                    sh 'chmod +x node_modules/.bin/vite'
                    sh 'npm run build'
                }
            }
        }

        stage('Image build & Push') {
            steps {
                container('docker') {
                    script {
                        def dockerImageVersion = "${env.BUILD_NUMBER}"

                        sh 'docker logout'

                        withCredentials([usernamePassword(
                            credentialsId: DOCKER_CREDENTIALS_ID,
                            usernameVariable: 'DOCKER_USERNAME',
                            passwordVariable: 'DOCKER_PASSWORD'
                        )]) {
                            sh 'echo $DOCKER_PASSWORD | docker login -u $DOCKER_USERNAME --password-stdin'
                            sh 'docker info' // 로그인 후 확인
                        }

                        withEnv(["DOCKER_IMAGE_VERSION=${dockerImageVersion}"]) {
                            sh 'docker -v'
                            sh 'docker build -t $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION .'
                            sh 'docker image inspect $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION'
                            sh 'docker push $DOCKER_IMAGE_NAME:$DOCKER_IMAGE_VERSION'
                        }
                    }
                }
            }
        }

        stage('Trigger yygang-app-manifest') {
            steps {
                script {
                    def dockerImageVersion = "${env.BUILD_NUMBER}"

                    withEnv(["DOCKER_IMAGE_VERSION=${dockerImageVersion}"]) {
                        build job: 'yygang-app-manifest',
                        parameters: [
                            string(name: 'DOCKER_IMAGE_VERSION', value: "${DOCKER_IMAGE_VERSION}")
                        ],
                        wait: true
                    }
                }
            }
        }
    }

    post {
        always {
            withCredentials([string(
                credentialsId: 'discord-webhook',
                variable: 'DISCORD_WEBHOOK_URL'
            )]) {
                discordSend description: """
                제목 : ${currentBuild.displayName}
                결과 : ${currentBuild.result}
                실행 시간 : ${currentBuild.duration / 1000}s
                """,
                result: currentBuild.currentResult,
                title: "${env.JOB_NAME} : ${currentBuild.displayName}",
                webhookURL: "${DISCORD_WEBHOOK_URL}"
            }
        }
    }
}


```
</details>


<details><summary>Backend manifest pipeline

</summary>

```yaml

pipeline {
    agent any
    parameters {
        string(name: 'DOCKER_IMAGE_VERSION', defaultValue: '', description: 'parameter')
    }
    stages {
        stage('Update deploy.yaml') {
            steps {
                // Jenkins 파이프라인에서 작업 디렉토리를 변경하는 과정
                script{
                    def imageTag = "${params.DOCKER_IMAGE_VERSION}"
                    echo "${params.DOCKER_IMAGE_VERSION}"
                    sh 'pwd'
                    sh 'ls -al'
                    sh 'git checkout main'
                    sh "sed -i 's|namoo36/yygang-app:.*|namoo36/yygang-app:${params.DOCKER_IMAGE_VERSION}|g' yygang-fe/deploy.yaml"
                    sh 'cat yygang-fe/deploy.yaml'
                }
            }
        }
        // stage('Echo Param Value') {
        //     steps {
        //         echo "DOCKER_IMAGE_VERSION param received: '${params.DOCKER_IMAGE_VERSION}'"
        //     }
        // }
        stage('Commit & Push'){
            steps {
                sh 'git config --list'
                sh 'git config user.name "namoo36"'
                sh 'git config user.email "wldnrkwhr36@naver.com"'
                sh 'git config --list'
                sh 'git add .'
                sh "git commit -m 'Update Image Version ${params.DOCKER_IMAGE_VERSION}'"
                // sh 'git diff --cached --quiet || git commit -m "Update Image Version ${params.DOCKER_IMAGE_VERSION}"'
                sh 'git status'
                // 활성화 -> 젠킨스에 등록한 키 이름 주기
                sshagent(['yyGang-manifest-key']){
                    sh 'git push'
                }
            }
        }
    }
 }

```
</details>
<br>

### ✔️ 도구 구성 

- **Jenkins, ArgoCD**를 사용한 자동화된 CI/CD
- **Docker** 기반 컨테이너 이미지 빌드
- **Nginx + Spring Boot**를 통한 웹 서버 구성

<br><br>
## 🚀 Jenkins

### 🧭 Jenkins 사용 이유
- CI Tool로 코드 변경 시 **빌드 → 테스트 → 이미지 생성 및 푸시**까지 담당함
- 온프레미스 환경 및 클라우드 환경에서 독립 운영이 가능하기 때문에 보안 확보가 좋음
    - Travis CI/CircleCI는 온프레미스 지원이 약함
- 호환성이 좋음 → **Docker**, **Kubernetes**, **Ansible과 연동 원활**
- 다양한 플러그인 및 스크립트를 통한 유연한 배포 가능
- 복잡한 파이프라인의 세밀한 제어에 좋음

<strong>**yyGang**</strong>
- 영양제 커스터마이징에 중점을 둔 yyGang 의 특성상 게시판, 약사 질문 등의 기능 업데이트 및 다양한 건강 기능 태그 업데이트 등이 빈번함에 따라 빠른 배포가 중요.
- 개인 건강 관련 데이터를 다루는 만큼 다른 도구에 비해 보안 측면에서 유리함

<br><br>
## 🚀 ArgoCD

### 🧭 ArgoCD 사용 이유

> **지속적 배포(CD)**를 안정적이고 자동화된 방식으로 구현하기 위해  
> GitOps 방식의 도구인 **ArgoCD**를 선택했습니다.

ArgoCD는 Git 저장소를 애플리케이션의 단일 진실 소스로 삼아  
변경 사항을 자동으로 감지하고 배포하는 **GitOps 기반 CD 도구**입니다.

---

### ✅ ArgoCD의 주요 장점

<details>
<summary><strong>1. Git 중심의 배포 관리</strong></summary>

Argo CD는 Git에 기록된 설정을 기준으로 애플리케이션을 배포합니다.  
모든 변경 내용은 Git에 남기 때문에 **버전 관리가 쉽고**, 문제가 생기면 이전 상태로 **쉽게 되돌릴 수 있습니다.**

</details>

<details>
<summary><strong>2. 자동화된 동기화</strong></summary>

Argo CD는 GitOps 원칙에 따라 **자동으로 클러스터와 동기화**합니다.  
Git에 변경 사항이 생기면 이를 감지해 Kubernetes를 자동으로 업데이트합니다.  
덕분에 배포를 수동으로 할 필요가 없고, **안정적인 운영이 가능합니다.**

</details>

<details>
<summary><strong>3. Blue-Green 배포 전략 지원</strong></summary>

Argo CD는 **Blue-Green 배포 전략**을 지원합니다.  
운영 중인 환경(Blue)과 새 버전 환경(Green)을 동시에 유지하고, 문제 없는 것을 확인한 후 트래픽을 Green으로 전환합니다.  
**무중단 배포와 빠른 롤백**이 가능합니다.

</details>

<details>
<summary><strong>4. 확장성과 유연성</strong></summary>

Argo CD는 대규모 Kubernetes 클러스터에서도 **유연하게 확장**할 수 있습니다.  
여러 클러스터를 동시에 관리할 수 있으며, 클러스터마다 **다른 설정을 적용**할 수 있습니다.  
덕분에 다양한 환경에서도 **일관된 배포가 가능합니다.**

</details>

<details>
<summary><strong>5. 강력한 보안성</strong></summary>

Argo CD는 Git을 기준으로 애플리케이션 상태를 관리하므로, **누가 언제 무엇을 배포했는지 추적**할 수 있습니다.  
배포 실수나 보안 사고를 사전에 방지할 수 있고, **인증과 권한 관리**도 지원하여 팀 단위 보안 운영이 가능합니다.

</details>
<br>



### ✔️ 흐름 설명

<details><summary>CI/CD 흐름 설명

</summary>

1. Application 변경 사항(프로젝트 코드) Github에 코드 push

      - Vue.js(프론트엔드), Spring Boot(백엔드) 프로젝트에서 수정된 소스 코드를 GitHub의 메인 저장소로 푸시
<br><br>
2. Jenkins가 Webhook을 통해 이벤트를 감지

      - [Backend] : Backend pileline이 동작하게 되고, Gradle 빌드하여 jar파일 생성 :
 
   - [Frontend] : Frondend pipeline이 동작하게 되고, npm 빌드하여 dist폴더 생성
<br><br>
3. 빌드된 결과물은 Dockerfile을 사용하여 Docker image로 생성
<br><br>
4. Docker image 생성 후 외부 저장소(Docker Hub)로 push하여 저장
<br><br>
5. Jenkins가 별도의 Git 저장소에 배포용 YAML 파일 업데이트(ex.deployment.yaml, service.yaml…) & 이미지를 최신으로 업데이트
<br><br>
6. ArgoCd는 Git 저장소의 변경을 감지 및 자동 동기화
    
    - 지정된 Git 저장소의 변경을 감지하면 자동으로 Kubernetes 클러스터에 해당 리소스를 동기화 
<br><br>
7. Kubernetes 클러스터에 최신 컨테이너 자동 배포
    - ArgoCD는 최신 이미지를 사용하여 새로운 Pod를 생성하고, 이전 Pod를 점진적으로 종료하는 롤링 업데이트 방식으로 무중단 배포를 수행

</details>

## 📈오토스케일링

> Kubernetes에서는 리소스 상황에 따라 **자동으로 리소스를 확장하거나 축소**할 수 있는 다양한 오토스케일링 기능을 제공합니다.

### ✅ 주요 오토스케일링 구성 요소


<details><summary>🔹 HPA (Horizontal Pod Autoscaler) 
</summary>


### HPA(HorizontalPodAutoscaler)

- CPU, 메모리 등의 사용률을 체크해서 Pod의 개수를 Scaling 하는 오브젝트이다.

- 서비스에 사용자가 늘어나 경우 원활한 서비스를 위해 서버를 늘리고, 다시 여유로운 상황이 되면 불필요한 서버를 자동으로 줄여 발생하는 요금을 낮출 수 있다.

```
hpa.yaml 파일
```

<br>

<details><summary> 부하 증가 테스트
</summary>

<br>

- 임시 pod 생성 후 내부 컨테이너 접속
```
kubectl run -i --tty load-generator --rm --image=busybox --restart=Never -- /bin/sh
```
<br>

- 무한루프 쿼리 전송
```
while sleep 0.1; do wget --header="Authorization: Bearer <Token> http://yygang-api:8000/; done
```

<br>

- 부하 증가 확인

![Image](https://github.com/user-attachments/assets/33f79cbf-65df-4aec-a261-6f09a0dd5040)

</details>


<details><summary>  pod 오토 스케일링
</summary>

<br>

- 사용량이 증가함에 따라 pod를 늘린 후 cpu 안정화
 
![Image](https://github.com/user-attachments/assets/b2b8c83b-b328-4057-bd5d-fcefd340dace)

</details>


<details><summary> 포드 증가 확인(ArgoCD)
</summary>

<br>

- CPU 부하 전

![Image](https://github.com/user-attachments/assets/f86de065-293e-4006-be0f-21871f21ee51)

- CPU 부하 후(pod 증가)

![Image](https://github.com/user-attachments/assets/411dc654-99db-4016-8200-7e51181ae92c)


</details>



</details> 


<details><summary>🔹 Karpenter
</summary>

###  Karpenter

노드 수준의 오토스케일링을 담당하며, Pod가 스케줄되지 못하고 Pending 상태일 때 **자동으로 새로운 Worker Node를 생성**합니다.

![karpenter](https://github.com/user-attachments/assets/ef9bb4fd-2d13-46c3-b0bf-198991b001bd)

##### ⚙️ 작동 흐름

1. **HPA가 Pod를 자동 확장** 또는 재배포합니다.
2. **Kube-scheduler**가 기존 Node에 Pod를 스케줄링하려 시도합니다.
3. 기존 Node에 자원이 부족해 Pod는 **Pending 상태**가 됩니다.
4. **Karpenter가 Pending 상태의 Pod를 감지**하고, 새로운 Worker Node를 **자동 생성**합니다.
5. **Kube-scheduler가 새 Node에 Pod를 스케줄링**합니다.

##### ✅ 장점

- 노드 프로비저닝과 Pod 스케줄링을 자동으로 처리
- 스케일링 속도가 빠름
- Pod 요구사항에 최적화된 노드 생성
- 불필요한 노드 종료로 **비용 절감 효과**

</details>
<br><br>

## 🔄무중단 배포  
### 🔵🟢 블루/그린 배포 (Blue-Green Deployment)

> 두 개의 동일한 환경(**블루**, **그린**)을 준비하여  
한쪽 환경에서 서비스를 운영하는 동안 다른 환경에 새 버전을 배포합니다.  
보통 **blue가 현재 운영 중**, **green이 새 버전**을 의미합니다.<br>
![65c3a844357606c1b08a21f0_Screen-Shot-2021-03-19-at-2 34 46-PM](https://github.com/user-attachments/assets/0ef46c75-a9de-418a-abdf-770a1e03285b)

---

### ⚙️ 배포 흐름

1. **그린 환경 구성**  
   - 현재 운영 중인 블루 환경과 동일한 사양으로 그린 환경을 준비합니다.
2. **새로운 버전 배포**  
   - 그린 환경에 새로운 버전의 애플리케이션을 배포합니다.
3. **테스트 및 검증**  
   - 그린 환경에서 애플리케이션을 테스트하고 검증합니다.
4. **트래픽 전환**  
   - 테스트 완료되면 로드 밸런서를 통해 트래픽을 블루에서 그린으로 전환합니다.
5. **모니터링**  
   - 그린 환경에서 애플리케이션이 정상적으로 **운영되는지 모니터링**합니다.

---

### ✅ 장점

- **실제 운영 환경 테스트**: 새로운 버전을 운영 환경과 동일한 환경에서 사전 테스트 가능합니다.  
- **빠른 롤백**: 문제가 생기면 트래픽을 간단히 **블루로 되돌려** 빠르게 복구 가능합니다.

---

### ⚠️ 단점

- **비용**: 블루와 그린 환경을 **동시에 유지**해야 하므로 자원이 2배 필요합니다.

---

### 🔁 그린 → 블루 롤백 명령어

```bash
kubectl argo rollouts undo rollout rollout-bluegreen -n bluegreen-test
```





<br><br><br><br><br><br><br><br>
<br><br><br><br><br><br><br><br>
